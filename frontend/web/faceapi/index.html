<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Face Detection</title>
    <style>
      #video {
        transform: scaleX(-1);
        width: 100%;
        height: auto;
      }
      canvas {
        position: absolute;
        top: 0;
        left: 0;
      }
    </style>
  </head>
  <body>
    <h1>Face Detection</h1>
    <video id="video" autoplay></video>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.12.0"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection@0.1.1/face-landmarks-detection.js"></script> -->
    <script>
      // Load face-landmarks-detection model
      const model = await faceLandmarksDetection.load(
        faceLandmarksDetection.SupportedPackages.mediapipeFacemesh
      )

      // Define startVideo function to access the laptop camera
      function startVideo() {
        navigator.mediaDevices.getUserMedia({
          video: true
        })
        .then(stream => {
          const video = document.getElementById('video')
          video.srcObject = stream
          video.addEventListener('play', () => {
            const canvas = document.createElement('canvas')
            const context = canvas.getContext('2d')
            canvas.width = video.videoWidth
            canvas.height = video.videoHeight
            document.body.appendChild(canvas)
            setInterval(() => {
              context.clearRect(0, 0, canvas.width, canvas.height)
              context.drawImage(video, 0, 0, canvas.width, canvas.height)
              detectFaces(canvas)
            }, 100)
          })
        })
        .catch(error => {
          console.error(error)
        })
      }

      // Define detectFaces function to detect faces in each frame
      async function detectFaces(canvas) {
        const faces = await model.estimateFaces({
          input: canvas,
          predictIrises: false
        })
        if (faces.length > 0) {
          const face = faces[0]
          console.log(`Face detected at coordinates: (${face.topLeft[0]}, ${face.topLeft[1]})`)
        }
      }

      // Start the video stream
      startVideo()
    </script>
  </body>
</html>
